// Global Data Array
let globalData = [
    {
        "id": 1,
        "name": "Abram Langtry",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "female",
        "salary": 95000
    },
    {
        "id": 2,
        "name": "Flossy Arrell",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Product Management",
        "gender": "others",
        "salary": 20000
    },
    {
        "id": 3,
        "name": "Giorgio Antonioni",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "others",
        "salary": 95000
    },
    {
        "id": 4,
        "name": "Benji Knapman",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Research and Development",
        "gender": "male",
        "salary": 15000
    },
    {
        "id": 5,
        "name": "Thedrick Sigfrid",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Product Management",
        "gender": "others",
        "salary": 115000
    },
    {
        "id": 6,
        "name": "Leonora Pachmann",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "male",
        "salary": 140000
    },
    {
        "id": 7,
        "name": "Wait Hayworth",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Services",
        "gender": "others",
        "salary": 80000
    },
    {
        "id": 8,
        "name": "Kalina Bispo",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "male",
        "salary": 60000
    },
    {
        "id": 9,
        "name": "Nevile Logan",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Support",
        "gender": "female",
        "salary": 145000
    },
    {
        "id": 10,
        "name": "Tiffani Deshorts",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "others",
        "salary": 40000
    },
    {
        "id": 11,
        "name": "Waring Pemberton",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Product Management",
        "gender": "others",
        "salary": 105000
    },
    {
        "id": 12,
        "name": "Udall Boston",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "male",
        "salary": 145000
    },
    {
        "id": 13,
        "name": "Juliette Macauley",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Services",
        "gender": "female",
        "salary": 60000
    },
    {
        "id": 14,
        "name": "Dene Teenan",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Services",
        "gender": "female",
        "salary": 130000
    },
    {
        "id": 15,
        "name": "Shirl St. Clair",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Product Management",
        "gender": "female",
        "salary": 50000
    },
    {
        "id": 16,
        "name": "Wilbur Jewett",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Accounting",
        "gender": "male",
        "salary": 105000
    },
    {
        "id": 17,
        "name": "Ola Desouza",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Research and Development",
        "gender": "male",
        "salary": 70000
    },
    {
        "id": 18,
        "name": "Phyllis Tallowin",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Support",
        "gender": "male",
        "salary": 45000
    },
    {
        "id": 19,
        "name": "Erich Gunther",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "male",
        "salary": 75000
    },
    {
        "id": 20,
        "name": "Lorna Tacey",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Marketing",
        "gender": "others",
        "salary": 85000
    },
    {
        "id": 21,
        "name": "Mendy Burrells",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Research and Development",
        "gender": "others",
        "salary": 120000
    },
    {
        "id": 22,
        "name": "Rosy Gray",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "others",
        "salary": 50000
    },
    {
        "id": 23,
        "name": "Angel Abramamov",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Marketing",
        "gender": "others",
        "salary": 120000
    },
    {
        "id": 24,
        "name": "Lewiss Chippindale",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "male",
        "salary": 50000
    },
    {
        "id": 25,
        "name": "Belinda Renzini",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "others",
        "salary": 130000
    },
    {
        "id": 26,
        "name": "Korry Champken",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Research and Development",
        "gender": "female",
        "salary": 20000
    },
    {
        "id": 27,
        "name": "Vale Fenny",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Services",
        "gender": "male",
        "salary": 145000
    },
    {
        "id": 28,
        "name": "Itch Wagstaff",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "others",
        "salary": 95000
    },
    {
        "id": 29,
        "name": "Colet Tander",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Human Resources",
        "gender": "others",
        "salary": 90000
    },
    {
        "id": 30,
        "name": "Keeley Mizzi",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Support",
        "gender": "others",
        "salary": 45000
    },
    {
        "id": 31,
        "name": "Thorny Rasper",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Services",
        "gender": "others",
        "salary": 45000
    },
    {
        "id": 32,
        "name": "Nev Tinston",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Product Management",
        "gender": "male",
        "salary": 10000
    },
    {
        "id": 33,
        "name": "Trevar Shearn",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "others",
        "salary": 95000
    },
    {
        "id": 34,
        "name": "Kittie Peschmann",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "female",
        "salary": 75000
    },
    {
        "id": 35,
        "name": "Rickie Westgate",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "female",
        "salary": 75000
    },
    {
        "id": 36,
        "name": "Noam Renard",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Legal",
        "gender": "female",
        "salary": 85000
    },
    {
        "id": 37,
        "name": "Brendan Cutill",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Sales",
        "gender": "male",
        "salary": 130000
    },
    {
        "id": 38,
        "name": "Carney Tripet",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Support",
        "gender": "female",
        "salary": 65000
    },
    {
        "id": 39,
        "name": "Carlynn Joncic",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "male",
        "salary": 15000
    },
    {
        "id": 40,
        "name": "Anselma Dybald",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "female",
        "salary": 20000
    },
    {
        "id": 41,
        "name": "Jacki Bathowe",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Legal",
        "gender": "others",
        "salary": 40000
    },
    {
        "id": 42,
        "name": "Clayborn Bithell",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Human Resources",
        "gender": "others",
        "salary": 80000
    },
    {
        "id": 43,
        "name": "Akim Jaher",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Services",
        "gender": "male",
        "salary": 130000
    },
    {
        "id": 44,
        "name": "Berty Bengtsson",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "male",
        "salary": 75000
    },
    {
        "id": 45,
        "name": "Diann Wyley",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "female",
        "salary": 100000
    },
    {
        "id": 46,
        "name": "Caleb O'Scanlan",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Accounting",
        "gender": "others",
        "salary": 25000
    },
    {
        "id": 47,
        "name": "Julian Woollam",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Product Management",
        "gender": "others",
        "salary": 10000
    },
    {
        "id": 48,
        "name": "Ondrea Possel",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Support",
        "gender": "female",
        "salary": 115000
    },
    {
        "id": 49,
        "name": "Eduardo Antognelli",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Services",
        "gender": "female",
        "salary": 55000
    },
    {
        "id": 50,
        "name": "Dorie Weymont",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Accounting",
        "gender": "others",
        "salary": 80000
    },
    {
        "id": 51,
        "name": "Casar Longmore",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "others",
        "salary": 90000
    },
    {
        "id": 52,
        "name": "Verene Grice",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "others",
        "salary": 15000
    },
    {
        "id": 53,
        "name": "Latashia Merigon",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Legal",
        "gender": "female",
        "salary": 90000
    },
    {
        "id": 54,
        "name": "Russell Robel",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Sales",
        "gender": "male",
        "salary": 70000
    },
    {
        "id": 55,
        "name": "Imogen Tinton",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Research and Development",
        "gender": "male",
        "salary": 95000
    },
    {
        "id": 56,
        "name": "Stanfield Ind",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Product Management",
        "gender": "male",
        "salary": 130000
    },
    {
        "id": 57,
        "name": "Taber Czadla",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Research and Development",
        "gender": "male",
        "salary": 130000
    },
    {
        "id": 58,
        "name": "Joceline Obee",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "male",
        "salary": 105000
    },
    {
        "id": 59,
        "name": "Timmie Paulino",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Marketing",
        "gender": "male",
        "salary": 145000
    },
    {
        "id": 60,
        "name": "Ciel Taree",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Legal",
        "gender": "male",
        "salary": 20000
    },
    {
        "id": 61,
        "name": "Lesly Janousek",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "male",
        "salary": 25000
    },
    {
        "id": 62,
        "name": "Corey Whitsun",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "others",
        "salary": 150000
    },
    {
        "id": 63,
        "name": "Cosimo Heistermann",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Support",
        "gender": "others",
        "salary": 60000
    },
    {
        "id": 64,
        "name": "Erek Giorgielli",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Support",
        "gender": "male",
        "salary": 85000
    },
    {
        "id": 65,
        "name": "Fidelia Manilo",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Marketing",
        "gender": "others",
        "salary": 120000
    },
    {
        "id": 66,
        "name": "Yoshi Gary",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Training",
        "gender": "female",
        "salary": 130000
    },
    {
        "id": 67,
        "name": "Riccardo Michell",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Marketing",
        "gender": "others",
        "salary": 105000
    },
    {
        "id": 68,
        "name": "Colly Kernoghan",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Engineering",
        "gender": "others",
        "salary": 20000
    },
    {
        "id": 69,
        "name": "Allys Sangwin",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Business Development",
        "gender": "female",
        "salary": 45000
    },
    {
        "id": 70,
        "name": "Norri Pechold",
        "image": "https://imgur.com/9xEcfJj",
        "department": "Research and Development",
        "gender": "female",
        "salary": 30000
    }
]
let data = [];
let filteredData = [];
let pages = 7;
let per_page = 10;
renderPagination(pages);

function renderPagination(pages, orderBy) {
    let pagination_root = document.getElementById("pagination-container");
    pagination_root.innerHTML = null;
    apiCall(1, orderBy);
    for (let page = 1; page <= pages; page++) {
        let button = document.createElement("button");
        button.setAttribute("class", "pagination-btn");
        button.innerText = page;
        button.addEventListener("click", function () {
            apiCall(page, orderBy);
        })
        pagination_root.append(button);
    }
}

// API Call
async function apiCall(page, orderBy) {
    if (orderBy != undefined) {
        console.log('sort');
        data = await fetch(
            `https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/get-employees?page=${page}&orderBy=${orderBy}`
        );
    }
    else
        data = await fetch(
            `https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/get-employees?page=${page}`
        );

    data = await data.json();
    pages = data.totalPages;
    data = data.data;
    filteredProducts = globalData;
    renderDOM(data)
}

function renderDOM(data) {
    console.log(data);
    let root = document.getElementById('employee-container');
    root.innerHTML = null;

    data.map((el) => {
        let employee = document.createElement('div');
        employee.setAttribute("class", "employee");

        let left_container = document.createElement("div");
        left_container.setAttribute("class", "left-container");

        let right_container = document.createElement("div");
        right_container.setAttribute("class", "right-container");

        let image = document.createElement("img");
        image.setAttribute("src", "https://www.clipartkey.com/mpngs/m/209-2095552_profile-picture-placeholder-png.png");
        image.setAttribute("class", "dp");

        let name = document.createElement("p");
        name.innerText = el.name;

        let department = document.createElement("p");
        department.innerText = el.department;

        let gender = document.createElement("p");
        gender.innerText = el.gender;

        let salary = document.createElement("p");
        salary.innerText = `â‚¹ ${el.salary}`;

        left_container.append(image);
        right_container.append(name, department, gender, salary);
        employee.append(left_container, right_container);
        root.append(employee);
    })
}


//Sort by Salary functionality
let sort_price = document.getElementById('filter-sort');
sort_price.addEventListener("change", sortByPrice);
function sortByPrice() {

    let query = sort_price.value;
    console.log(query);
    if (query == "lth") {
        filteredData.sort(function (a, b) {
            return parseFloat(a.salary) - parseFloat(b.salary);
        });
        renderDOM(filteredData);
    }
    if (query == "htl") {
        filteredData.sort(function (a, b) {
            return parseFloat(b.salary) - parseFloat(a.salary);
        });
        renderDOM(filteredData);
    }
}

//Filter by Department functionality
let filter_category = document.getElementById('filter-department');
filter_category.addEventListener("change", filterCategory);
function filterCategory() {
    let category = filter_category.value;
    if (category == "none") {
        filteredData = globalData;
        renderPagination(pages);
    }

    else {
        filteredData = globalData.filter((el) => {
            return category == el.department;
        })
        document.getElementById("pagination-container").innerHTML = null;
        renderDOM(filteredData);
    }
}

//Search by name functionality
let searchEmployee = document.getElementById('search-employee');
searchEmployee.addEventListener("input", searchData);
function searchData() {
    let searchQuery = searchEmployee.value;
    searchQuery = searchQuery.toLowerCase();
    if (searchQuery == "") {
        filteredData = data;
    } else {
        filteredData = globalData.filter((el) => {
            let name = el.name.toLowerCase();
            console.log(name);
            return name.includes(searchQuery);
        });
        document.getElementById("pagination-container").innerHTML = null;
    }
    renderDOM(filteredData);
}